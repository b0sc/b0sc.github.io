---
const pathname = Astro.url.pathname;
const segments = pathname.split("/").filter(Boolean);
const active = segments[1] || "home";
const semester = segments[2] || null;

const faculties = [
  { name: "CSIT", key: "csit" },
  { name: "BIT", key: "bit" },
  { name: "BCA", key: "bca" },
  { name: "BICTE", key: "bicte" },
];

let backHref = "/notes";
let backTitle = "Notes";

if (semester) {
  backHref = `/notes/${active}`;
  backTitle = `Back to ${faculties.find((f) => f.key === active)?.name || "Faculty"}`;
} else if (active && active !== "home") {
  backHref = "/notes";
  backTitle = "Back to Notes";
}

const googleFormUrl = "https://forms.gle/duyocPr81Sy6nqfa8";
---

{/* UPDATED: Replaced `bg-white shadow-lg` with theme-aware background and border */}
<div class="md:w-48 bg-card md:min-h-screen border-r border-card-border">
  <div class="md:sticky md:top-20 pt-4 pr-2"> {/* Adjusted top to account for navbar */}
    <div class="flex flex-col space-y-2 overflow-y-auto md:overflow-x-visible pb-2 md:pb-0">
      <a
        class={`whitespace-nowrap px-4 py-2 text-left rounded-md transition-colors text-text ${
          active === "home" ? "hidden" : "hover:bg-hover"
        }`}
        href={backHref}
      >
        ⬅️ {backTitle}
      </a>

      {faculties.map((faculty) => (
        <details class="group" open={active === faculty.key}>
          <summary
            class={`cursor-pointer px-4 py-2 rounded-md select-none transition-colors text-text ${
              active === faculty.key
                ? "bg-purple-300 dark:bg-purple-800 dark:text-purple-100 font-semibold"
                : "hover:bg-hover"
            }`}
          >
            {faculty.name}
          </summary>
          <ul class="pl-4 py-2 space-y-1">
            {[...Array(8)].map((_, i) => {
              const sem = (i + 1).toString();
              return (
                <li>
                  <a
                    href={`/notes/${faculty.key}/${sem}`}
                    class={`block px-3 py-1 rounded-md transition-colors text-sm ${
                      active === faculty.key && semester === sem
                        ? "bg-purple-500 dark:bg-purple-600 text-white font-medium"
                        : "text-text-muted hover:text-text hover:bg-hover"
                    }`}
                  >
                    Semester {sem}
                  </a>
                </li>
              );
            })}
          </ul>
        </details>
      ))}
    </div>

    {/* UPDATED: Replaced hardcoded button colors with theme variables */}
    <a
      href={googleFormUrl}
      target="_blank"
      rel="noopener noreferrer"
     class="px-9 py-5 bg-zinc-900 hover:bg-white text-white hover:text-black border rounded-2xl justify-items-center md:justify-items-start gap-2.5 inline-flex"
    >
      Upload Resources
    </a>
  </div>
</div>